<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FrancoPro - Plateforme d'Apprentissage</title>
    <meta name="description" content="Plateforme interactive pour l'enseignement de la grammaire fran√ßaise">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <style>
        :root {
            --primary: #1e40af;
            --primary-dark: #1e3a8a;
            --bg: #ffffff;
            --surface: #f8fafc;
            --text: #0f172a;
            --text-secondary: #475569;
            --border: #e2e8f0;
            --success: #10b981;
        }
        [data-theme="dark"] {
            --primary: #3b82f6;
            --bg: #0f172a;
            --surface: #1e293b;
            --text: #f1f5f9;
            --text-secondary: #cbd5e1;
            --border: #334155;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            line-height: 1.6;
            transition: all 0.3s;
        }
        .header { 
            background: var(--surface); 
            border-bottom: 2px solid var(--border); 
            padding: 1rem; 
            position: sticky; 
            top: 0; 
            z-index: 100; 
        }
        .nav { 
            max-width: 1200px; 
            margin: 0 auto; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            gap: 0.5rem;
        }
        .logo-title { 
            font-size: 1.5rem; 
            font-weight: 700; 
            color: var(--primary); 
        }
        .logo-subtitle { 
            font-size: 0.75rem; 
            color: var(--text-secondary); 
        }
        .nav-buttons {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        .theme-toggle, .btn-primary { 
            padding: 0.6rem 1rem; 
            border-radius: 8px; 
            cursor: pointer; 
            border: none;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        .theme-toggle {
            background: var(--surface);
            border: 2px solid var(--border);
            color: var(--text);
        }
        .btn-primary { 
            background: var(--primary);
            color: white;
            text-decoration: none;
            display: inline-block;
        }
        .btn-primary:active { 
            transform: scale(0.95); 
        }
        .hero { 
            background: linear-gradient(135deg, var(--primary), var(--primary-dark)); 
            color: white; 
            padding: 2rem 1rem; 
            text-align: center; 
        }
        .hero h1 { 
            font-size: clamp(1.5rem, 4vw, 2.5rem); 
            margin-bottom: 0.5rem; 
        }
        .hero p {
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            opacity: 0.95;
            margin-bottom: 1rem;
        }
        .university-badge { 
            background: rgba(255, 255, 255, 0.2); 
            padding: 0.75rem 1.5rem; 
            border-radius: 8px; 
            display: inline-block; 
        }
        .section { 
            max-width: 1200px; 
            margin: 2rem auto; 
            padding: 0 1rem; 
        }
        .chat-container { 
            background: var(--surface); 
            border-radius: 12px; 
            padding: 1rem; 
            margin-top: 1rem; 
        }
        .chat-messages { 
            max-height: 400px; 
            overflow-y: auto; 
            margin-bottom: 1rem; 
            padding: 1rem; 
            background: var(--bg); 
            border-radius: 8px; 
        }
        .message { 
            margin-bottom: 1rem; 
            padding: 1rem; 
            border-radius: 8px; 
            word-wrap: break-word;
        }
        .message.user { 
            background: var(--primary); 
            color: white; 
            margin-left: 10%;
        }
        .message.assistant { 
            background: var(--surface); 
            border: 2px solid var(--border); 
            margin-right: 10%;
        }
        .message strong {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        .message-actions { 
            display: flex; 
            gap: 0.5rem; 
            margin-top: 0.75rem;
            flex-wrap: wrap;
        }
        .action-btn { 
            background: var(--bg); 
            border: 1px solid var(--border); 
            padding: 0.4rem 0.8rem; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 0.8rem;
            transition: all 0.2s;
        }
        .action-btn:active { 
            transform: scale(0.95); 
        }
        .chat-input-container { 
            display: flex; 
            gap: 0.5rem; 
        }
        .chat-input { 
            flex: 1; 
            padding: 0.75rem; 
            border: 2px solid var(--border); 
            border-radius: 8px; 
            background: var(--bg); 
            color: var(--text); 
            font-size: 1rem; 
            resize: none;
            min-height: 60px;
            font-family: inherit;
        }
        .chat-input:focus { 
            outline: none; 
            border-color: var(--primary); 
        }
        .loading { 
            display: none; 
            text-align: center; 
            padding: 1rem;
            color: var(--text-secondary);
        }
        .loading.active { display: block; }
        footer { 
            background: var(--surface); 
            border-top: 2px solid var(--border); 
            padding: 2rem 1rem; 
            margin-top: 2rem; 
            text-align: center;
        }
        .toast { 
            position: fixed; 
            bottom: 2rem; 
            left: 50%; 
            transform: translateX(-50%) translateY(100px); 
            background: var(--success); 
            color: white; 
            padding: 0.75rem 1.5rem; 
            border-radius: 8px; 
            z-index: 1001; 
            transition: transform 0.3s; 
        }
        .toast.active { 
            transform: translateX(-50%) translateY(0); 
        }
        @media (max-width: 768px) {
            .logo-subtitle { display: none; }
            .message.user, .message.assistant { 
                margin: 0 0 1rem 0; 
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="logo">
                <div class="logo-title">FrancoPro</div>
                <div class="logo-subtitle">Sciences du Langage</div>
            </div>
            <div class="nav-buttons">
                <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()">üåô</button>
                <a href="#platform" class="btn-primary">Tester</a>
            </div>
        </nav>
    </header>

    <section class="hero">
        <div>
            <h1>Plateforme d'Apprentissage de la Grammaire Fran√ßaise</h1>
            <p>Technologies avanc√©es pour l'enseignement aux apprenants arabophones</p>
            <div class="university-badge">
                <strong>üéì Universit√© de Mostaganem</strong><br>
                Master en Sciences du Langage
            </div>
        </div>
    </section>

    <main>
        <section class="section" id="platform">
            <h2 style="text-align: center; color: var(--primary); margin-bottom: 0.5rem;">Assistant P√©dagogique</h2>
            <p style="text-align: center; color: var(--text-secondary); margin-bottom: 1rem;">Posez vos questions sur la grammaire fran√ßaise</p>
            
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <div class="message assistant">
                        <strong>üéì Assistant</strong>
                        <p>Bonjour! Je suis votre assistant p√©dagogique.</p>
                        <p style="margin-top: 0.5rem;"><strong>Vous pouvez:</strong></p>
                        <ul style="margin-left: 1.5rem; margin-top: 0.5rem; font-size: 0.9rem;">
                            <li>Demander des le√ßons grammaticales</li>
                            <li>Obtenir des exercices (A1-C2)</li>
                            <li>Poser des questions sp√©cifiques</li>
                        </ul>
                    </div>
                </div>
                <div class="loading" id="loading">‚è≥ Pr√©paration...</div>
                <div class="chat-input-container">
                    <textarea class="chat-input" id="chatInput" placeholder="Votre question..." rows="2"></textarea>
                    <button class="btn-primary" id="sendBtn" onclick="sendMessage()" style="padding: 0.75rem 1.5rem;">Envoyer</button>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p style="font-size: 1rem; margin-bottom: 0.5rem;"><strong>FrancoPro</strong></p>
        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Universit√© de Mostaganem</p>
        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">Ann√©e 2024-2025</p>
        <div style="padding-top: 1rem; border-top: 2px solid var(--border); color: var(--text-secondary);">
            <p style="font-size: 0.85rem;">&copy; 2025 FrancoPro</p>
            <p style="font-size: 0.85rem; margin-top: 0.3rem;">D√©velopp√© par <strong>BETTAHAR Abdelkrim</strong></p>
        </div>
    </footer>

    <div class="toast" id="toast"></div>

    <script>
        // Theme Toggle
        function toggleTheme() {
            const body = document.body;
            const toggle = document.getElementById('themeToggle');
            
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                toggle.textContent = 'üåô';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                toggle.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Load saved theme
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.setAttribute('data-theme', 'dark');
            document.getElementById('themeToggle').textContent = '‚òÄÔ∏è';
        }

        // Chat functionality
        const chatInput = document.getElementById('chatInput');
        const chatMessages = document.getElementById('chatMessages');
        const loading = document.getElementById('loading');

        async function sendMessage() {
            const userMessage = chatInput.value.trim();
            if (!userMessage) return;

            // Add user message
            const userMsg = document.createElement('div');
            userMsg.className = 'message user';
            userMsg.innerHTML = `<strong>Vous</strong><p>${escapeHtml(userMessage)}</p>`;
            chatMessages.appendChild(userMsg);
            chatInput.value = '';

            loading.classList.add('active');
            chatMessages.scrollTop = chatMessages.scrollHeight;

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: userMessage })
                });

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const data = await response.json();
                loading.classList.remove('active');

                // Add assistant message
                const assistantMsg = document.createElement('div');
                assistantMsg.className = 'message assistant';
                const formatted = data.response.replace(/\n\n/g, '</p><p>').replace(/\n/g, '<br>');
                assistantMsg.innerHTML = `
                    <strong>üéì Assistant</strong>
                    <div><p>${formatted}</p></div>
                    <div class="message-actions">
                        <button class="action-btn" onclick="copyText(this)">üìã Copier</button>
                        <button class="action-btn" onclick="downloadPDF(this)">üìÑ PDF</button>
                    </div>
                `;
                chatMessages.appendChild(assistantMsg);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            } catch (error) {
                loading.classList.remove('active');
                const errorMsg = document.createElement('div');
                errorMsg.className = 'message assistant';
                errorMsg.innerHTML = `<strong>‚ùå Erreur</strong><p>Impossible de se connecter. V√©rifiez votre connexion.</p>`;
                chatMessages.appendChild(errorMsg);
            }
        }

        // Enter key support
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function copyText(btn) {
            const content = btn.closest('.message').querySelector('div').innerText;
            navigator.clipboard.writeText(content).then(() => {
                showToast('‚úÖ Copi√©');
                btn.innerHTML = '‚úÖ';
                setTimeout(() => btn.innerHTML = 'üìã Copier', 2000);
            });
        }

        function downloadPDF(btn) {
            const content = btn.closest('.message').querySelector('div').innerText;
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFontSize(14);
            doc.text('FrancoPro - Le√ßon', 20, 20);
            doc.setFontSize(10);
            doc.text('BETTAHAR Abdelkrim', 20, 28);
            doc.setFontSize(11);
            const lines = doc.splitTextToSize(content, 170);
            doc.text(lines, 20, 38);
            doc.save(`Lecon-${Date.now()}.pdf`);
            showToast('‚úÖ PDF t√©l√©charg√©');
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('active');
            setTimeout(() => toast.classList.remove('active'), 2500);
        }
    </script>
</body>
</html>